<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>גידול חיידקים: חיים מול אבסולוטי</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; direction: rtl; }
        .slider-container { margin: 10px; }
    </style>
</head>
<body>
    <h2>השוואה: תאים חיים מול כמות אבסולוטית</h2>

    <div class="slider-container">
        μmax: <input type="range" id="muMax" min="0.1" max="1" step="0.05" value="0.5">
        <span id="muMaxVal">0.5</span>
    </div>
    <div class="slider-container">
        Ks: <input type="range" id="ks" min="0.01" max="5" step="0.1" value="0.5">
        <span id="ksVal">0.5</span>
    </div>
    <div class="slider-container">
        שיעור תמותה: <input type="range" id="deathRate" min="0" max="0.5" step="0.01" value="0.1">
        <span id="deathRateVal">0.1</span>
    </div>

    <div id="graph"></div>

    <script>
        function monod(muMax, Ks, S) {
            return muMax * S / (Ks + S);
        }

        function simulate(muMax, Ks, deathRate) {
            let t = [], Xlive = [], Xtotal = [], S = [];
            let dt = 0.1, Tmax = 20;
            let s = 10, xlive = 0.1, xtotal = 0.1;

            for (let time = 0; time <= Tmax; time += dt) {
                t.push(time);
                Xlive.push(xlive);
                Xtotal.push(xtotal);
                S.push(s);

                let mu = monod(muMax, Ks, s);
                let growth = mu * xlive * dt;
                let death = deathRate * xlive * dt;
                let ds = -growth;

                xtotal += growth;               // כלל התאים שגדלו (לא מושפע מתמותה)
                xlive += growth - death;        // רק החיים, תמותה חלה עליהם
                xlive = Math.max(xlive, 0);
                s = Math.max(s + ds, 0);
            }

            return { t, Xlive, Xtotal, S };
        }

        function plot(muMax, Ks, deathRate) {
            const data = simulate(muMax, Ks, deathRate);

            const traces = [
                { x: data.t, y: data.Xtotal, name: 'סה"כ תאים (אבסולוטי)', type: 'scatter', line: { color: 'blue' } },
                { x: data.t, y: data.Xlive, name: 'תאים חיים', type: 'scatter', line: { color: 'green' } },
                { x: data.t, y: data.S, name: 'סובסטרט', type: 'scatter', line: { dash: 'dot', color: 'red' } }
            ];

            Plotly.newPlot('graph', traces, {
                title: 'גידול חיידקים: תאים חיים מול אבסולוטי',
                xaxis: { title: 'זמן (שעות)' },
                yaxis: { title: 'ריכוז תאים / סובסטרט' }
            });
        }

        const sliders = ['muMax', 'ks', 'deathRate'];
        sliders.forEach(id => {
            document.getElementById(id).addEventListener('input', update);
        });

        function update() {
            let muMax = parseFloat(document.getElementById('muMax').value);
            let ks = parseFloat(document.getElementById('ks').value);
            let deathRate = parseFloat(document.getElementById('deathRate').value);

            document.getElementById('muMaxVal').innerText = muMax;
            document.getElementById('ksVal').innerText = ks;
            document.getElementById('deathRateVal').innerText = deathRate;

            plot(muMax, ks, deathRate);
        }

        update();  // רנדר ראשוני
    </script>
</body>
</html>
