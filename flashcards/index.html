<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ×›×¨×˜×™×¡×™×•×ª ×–×™×›×¨×•×Ÿ</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; text-align: center; }
        .box { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px; width: 90%; }
        h1 { color: #333; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 30px; font-size: 0.9rem; }
        
        .step { margin-bottom: 20px; padding: 15px; border-radius: 10px; background-color: #fafafa; border: 1px solid #eee; }
        .step-title { font-weight: bold; margin-bottom: 10px; display: block; color: #555; }
        
        /* ×¢×™×¦×•×‘ ×›×¤×ª×•×¨ ×”×¢×œ××” */
        .custom-file-upload {
            display: inline-block;
            padding: 10px 25px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            transition: 0.3s;
        }
        .custom-file-upload:hover { background-color: #0069d9; }
        input[type="file"] { display: none; }

        /* ×¢×™×¦×•×‘ ×›×¤×ª×•×¨ ×”×•×¨×“×” */
        #downloadBtn {
            display: none; /* ××•×¡×ª×¨ ×‘×”×ª×—×œ×” */
            padding: 12px 30px;
            font-size: 1.1rem;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: 0.3s;
            margin: 0 auto;
        }
        #downloadBtn:hover { background-color: #218838; transform: scale(1.05); }

        #status { margin-top: 10px; font-weight: bold; min-height: 20px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>

<div class="box">
    <h1>××—×•×œ×œ ×›×¨×˜×™×¡×™×•×ª</h1>
    <p>×”××¢×¨×›×ª ×ª×™×¦×•×¨ ×§×•×‘×¥ HTML ×¢×¦×××™ ×©× ×™×ª×Ÿ ×œ×©×œ×•×— ×œ×¡×˜×•×“× ×˜×™×.</p>
    
    <div class="step">
        <span class="step-title">×©×œ×‘ 1: ×˜×¢×™× ×ª ×©××œ×•×ª</span>
        <label for="fileInput" class="custom-file-upload">
            ğŸ“‚ ×‘×—×¨×™ ×§×•×‘×¥ Excel
        </label>
        <input type="file" id="fileInput" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />
        <div id="status">×××ª×™×Ÿ ×œ×§×•×‘×¥...</div>
    </div>

    <div class="step">
        <span class="step-title">×©×œ×‘ 2: ×™×¦×™×¨×ª ×”××©×—×§</span>
        <button id="downloadBtn" onclick="downloadGame()">â¬‡ï¸ ×”×•×¨×™×“×™ ××ª ×”××©×—×§ ×”××•×›×Ÿ</button>
    </div>
</div>

<script>
    let processedCards = null; // ××©×ª× ×” ×œ×©××™×¨×ª ×”× ×ª×•× ×™× ×”××¢×•×‘×“×™×

    // ×”××–× ×” ×œ×‘×—×™×¨×ª ×§×•×‘×¥
    document.getElementById('fileInput').addEventListener('change', handleFile, false);

    function handleFile(e) {
        const file = e.target.files[0];
        const statusDiv = document.getElementById('status');
        const downloadBtn = document.getElementById('downloadBtn');
        
        // ××™×¤×•×¡ ××¦×‘
        downloadBtn.style.display = "none";
        statusDiv.className = "";
        processedCards = null;

        if (!file) return;

        statusDiv.innerText = "×§×•×¨× ×§×•×‘×¥...";
        
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                
                // ×§×¨×™××ª ×”×’×œ×™×•×Ÿ ×”×¨××©×•×Ÿ
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // ×”××¨×” ×œ-JSON
                const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                
                const validData = [];
                
                // ×¡×™× ×•×Ÿ ×•×¢×™×‘×•×“ ×”×©×•×¨×•×ª
                for(let i=0; i<jsonData.length; i++) {
                    const row = jsonData[i];
                    // ××•×•×“××™× ×©×™×© ×œ×¤×—×•×ª ×©× ×™ ×ª××™× ×¢× ×ª×•×›×Ÿ
                    if(row.length >= 2 && row[0] != null && row[1] != null) {
                        let q = row[0].toString().trim();
                        let a = row[1].toString().trim();
                        
                        // ×“×™×œ×•×’ ×¢×œ ×›×•×ª×¨×•×ª × ×¤×•×¦×•×ª
                        if (i === 0 && (q === "×©××œ×”" || q === "Question" || q === "question")) continue;
                        if (q === "" || a === "") continue;

                        validData.push({ question: q, answer: a });
                    }
                }

                if (validData.length === 0) {
                    throw new Error("×œ× × ××¦××• × ×ª×•× ×™× ×ª×§×™× ×™×. ×•×•×“××™ ×©×¢××•×“×” A ×”×™× ×”×©××œ×” ×•×¢××•×“×” B ×”×™× ×”×ª×©×•×‘×”.");
                }

                // ×”×¦×œ×—×”! ×©××™×¨×ª ×”× ×ª×•× ×™× ×•×”×¦×’×ª ×›×¤×ª×•×¨ ×”×”×•×¨×“×”
                processedCards = validData;
                statusDiv.innerText = `âœ… × ×˜×¢× ×• ×‘×”×¦×œ×—×” ${validData.length} ×›×¨×˜×™×¡×™×•×ª!`;
                statusDiv.className = "success";
                downloadBtn.style.display = "block"; // ×—×©×™×¤×ª ×”×›×¤×ª×•×¨ ×”×©× ×™

            } catch (err) {
                console.error(err);
                statusDiv.innerText = "âŒ ×©×’×™××”: " + err.message;
                statusDiv.className = "error";
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function downloadGame() {
        if (!processedCards) return;

        // ×ª×‘× ×™×ª ×”×§×•×‘×¥ ×”×¡×•×¤×™ (HTML ×‘×ª×•×š ××—×¨×•×–×ª)
        const htmlContent = `<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×›×¨×˜×™×¡×™×•×ª ×ª×¨×’×•×œ</title>
    <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\\\(', '\\\\)']], displayMath: [['$$', '$$'], ['\\\\[', '\\\\]']] }
    };
    <\/script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        .container { perspective: 1000px; width: 80%; max-width: 600px; height: 400px; position: relative; }
        .card { width: 100%; height: 100%; position: absolute; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1); cursor: pointer; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card.flipped { transform: rotateX(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; text-align: center; border-radius: 20px; font-size: 1.5rem; color: #333; overflow-y: auto; background-color: white; }
        .front { background: linear-gradient(135deg, #ffffff 0%, #e6f7ff 100%); border: 2px solid #b3e0ff; }
        .back { background: linear-gradient(135deg, #ffffff 0%, #fff0f0 100%); border: 2px solid #ffcccc; transform: rotateX(180deg); }
        .controls { margin-top: 30px; display: flex; gap: 20px; }
        button { padding: 12px 24px; font-size: 1rem; border: none; border-radius: 50px; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-family: inherit; font-weight: 600; }
        #nextBtn { background-color: #4CAF50; color: white; }
        #nextBtn:hover { background-color: #45a049; transform: translateY(-2px); }
        #resetBtn { background-color: #FF9800; color: white; }
        #resetBtn:hover { background-color: #e68a00; transform: translateY(-2px); }
        .progress { margin-top: 15px; color: #666; font-size: 0.9rem; }
        .hint { margin-top: 10px; font-size: 0.8rem; color: #888; }
        mjx-container { font-size: 110% !important; }
    </style>
</head>
<body>
    <div class="container" onclick="flipCard()">
        <div class="card" id="card">
            <div class="face front"><div id="questionText">×˜×•×¢×Ÿ...</div></div>
            <div class="face back"><div id="answerText">×˜×•×¢×Ÿ...</div></div>
        </div>
    </div>
    <div class="progress" id="progressText"></div>
    <div class="controls">
        <button id="resetBtn" onclick="resetGame(event)">××™×¤×•×¡</button>
        <button id="nextBtn" onclick="nextCard(event)">×”×‘× (Enter)</button>
    </div>
    <div class="hint">×¨×•×•×— ×œ×”×¤×•×š, Enter ×œ××¢×‘×¨</div>
    <script>
        const cardsData = ${JSON.stringify(processedCards)};
        let deck = [];
        let currentCardIndex = -1;
        
        function initGame() { 
            deck = Array.from(Array(cardsData.length).keys()); 
            shuffleDeck(); 
            nextCard(); 
        }
        
        function shuffleDeck() { 
            for (let i = deck.length - 1; i > 0; i--) { 
                const j = Math.floor(Math.random() * (i + 1)); 
                [deck[i], deck[j]] = [deck[j], deck[i]]; 
            } 
        }
        
        function updateProgress() { 
            const remaining = deck.length; 
            const total = cardsData.length; 
            document.getElementById('progressText').innerText = \`×›×¨×˜×™×¡×™×™×” \${total - remaining} ××ª×•×š \${total}\`; 
        }
        
        function nextCard(event) { 
            if (event) event.stopPropagation(); 
            if (deck.length === 0) { 
                alert("×›×œ ×”×›×‘×•×“! ×¡×™×™××ª ××ª ×›×œ ×”×›×¨×˜×™×¡×™×•×ª."); 
                initGame(); 
                return; 
            } 
            const cardElement = document.getElementById('card'); 
            cardElement.classList.remove('flipped'); 
            
            currentCardIndex = deck.pop(); 
            
            setTimeout(() => { 
                document.getElementById('questionText').innerHTML = cardsData[currentCardIndex].question; 
                document.getElementById('answerText').innerHTML = cardsData[currentCardIndex].answer; 
                if (window.MathJax) { 
                    MathJax.typesetPromise([document.getElementById('card')]).catch((err) => console.log(err)); 
                } 
                updateProgress(); 
            }, 200); 
        }
        
        function flipCard() { 
            document.getElementById('card').classList.toggle('flipped'); 
        }
        
        function resetGame(event) { 
            if (event) event.stopPropagation(); 
            if (confirm("×œ×”×ª×—×™×œ ××—×“×©?")) initGame(); 
        }
        
        document.addEventListener('keydown', function(event) { 
            if (event.code === 'Space') { event.preventDefault(); flipCard(); } 
            else if (event.code === 'Enter') { event.preventDefault(); nextCard(); } 
        });
        
        window.onload = initGame;
    <\/script>
</body>
</html>`;

        // ×™×¦×™×¨×ª ×”×§×•×‘×¥ ×œ×”×•×¨×“×”
        const blob = new Blob([htmlContent], {type: "text/html;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "flashcards_game.html";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>
