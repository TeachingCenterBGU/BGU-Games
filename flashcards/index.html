<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ×›×¨×˜×™×¡×™×•×ª ×–×™×›×¨×•×Ÿ ××¢×•×¦×‘</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #ff8fab; /* ×•×¨×•×“ ×¤×¡×˜×œ */
            --secondary-color: #8ac6d1; /* ×ª×›×œ×ª ×¨×š */
            --bg-color: #fff0f3;
            --text-color: #555;
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #fff0f3 0%, #e0f7fa 100%); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            margin: 0; 
            text-align: center; 
        }
        .box { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 40px; 
            border-radius: 25px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            max-width: 600px; 
            width: 90%; 
            border: 2px solid white;
        }
        .logo-container {
            margin-bottom: 20px;
        }
        .logo-container img {
            /* ×’×•×“×œ ××•×’×“×œ ×›×¤×™ ×©×‘×™×§×©×ª */
            max-width: 400px; 
            max-height: 300px;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
        }
        h1 { color: #333; margin-bottom: 5px; font-weight: 700; }
        p { color: #777; margin-bottom: 30px; font-size: 1rem; }
        
        .step { 
            margin-bottom: 25px; 
            padding: 20px; 
            border-radius: 15px; 
            background-color: #f8f9fa; 
            border: 1px solid #eee; 
            transition: transform 0.2s;
        }
        .step:hover { transform: translateY(-2px); border-color: var(--secondary-color); }
        .step-title { font-weight: bold; margin-bottom: 15px; display: block; color: #444; font-size: 1.1rem; }
        
        .custom-file-upload {
            display: inline-block;
            padding: 12px 30px;
            cursor: pointer;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50px;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 4px 10px rgba(138, 198, 209, 0.4);
        }
        .custom-file-upload:hover { background-color: #72b2bd; transform: scale(1.05); }
        input[type="file"] { display: none; }

        /* ×¢×™×¦×•×‘ ×œ×ª×¤×¨×™×˜ ×‘×—×™×¨×ª ×”×§×™×“×•×“ */
        .encoding-selector {
            margin-top: 20px;
            text-align: center;
            background: #fff;
            padding: 10px;
            border-radius: 10px;
            border: 1px dashed #ccc;
        }
        .encoding-selector label { font-size: 0.9rem; font-weight: bold; color: #555; }
        .encoding-selector select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #999;
            font-family: inherit;
            margin-top: 5px;
            width: 100%;
            max-width: 250px;
        }

        #downloadBtn {
            display: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 143, 171, 0.4);
            transition: 0.3s;
            margin: 0 auto;
        }
        #downloadBtn:hover { background-color: #ff7597; transform: scale(1.05); }

        #status { margin-top: 15px; font-weight: 600; min-height: 25px; font-size: 0.95rem; white-space: pre-wrap; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>

<div class="box">
    <div class="logo-container">
        <img src="logo.jpg" alt="×œ×•×’×• ×”×™×—×™×“×”" onerror="this.style.display='none'">
    </div>

<h1>××—×•×œ×œ ×›×¨×˜×™×¡×™×•×ª</h1>
    <p>
        ×”×¢×œ×• ×§×•×‘×¥ ××§×¡×œ ×•×”××¢×¨×›×ª ×ª×™×¦×•×¨ ××©×—×§ ×œ××™×“×” ××¢×•×¦×‘.<br>
        <strong>×˜×•×¨ A - ×¦×“ ×”×©××œ×•×ª | ×˜×•×¨ B - ×¦×“ ×”×ª×©×•×‘×•×ª</strong><br>
        <span style="font-size: 0.9em; color: #888;">(× ×•×¡×—××•×ª ××ª××˜×™×•×ª ×™×© ×œ×›×ª×•×‘ ×‘-LaTeX)</span>
    </p>
    
    <div class="step">
        <span class="step-title">×©×œ×‘ 1: ×˜×¢×™× ×ª ×©××œ×•×ª</span>
        <label for="fileInput" class="custom-file-upload">
            ğŸ“‚ ×‘×—×¨×• ×§×•×‘×¥ Excel / CSV
        </label>
        <input type="file" id="fileInput" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />
        
        <div class="encoding-selector">
            <label for="encodingSelect">×”×˜×§×¡×˜ ×™×¦× ×’'×™×‘×¨×™×©? × ×¡×• ×œ×©× ×•×ª ×›××Ÿ:</label><br>
            <select id="encodingSelect">
                <option value="UTF-8">UTF-8 (×¨×•×‘ ×”×§×‘×¦×™× ×”×—×“×©×™×)</option>
                <option value="windows-1255">Windows-1255 (××§×¡×œ ×‘×¢×‘×¨×™×ª ×™×©×Ÿ)</option>
                <option value="ISO-8859-8">ISO-8859-8 (×¢×‘×¨×™×ª ×•×™×–×•××œ×™×ª)</option>
            </select>
        </div>

        <div id="status">×××ª×™×Ÿ ×œ×§×•×‘×¥...</div>
    </div>

    <div class="step">
        <span class="step-title">×©×œ×‘ 2: ×™×¦×™×¨×ª ×”××©×—×§</span>
        <button id="downloadBtn" onclick="downloadGame()">â¬‡ï¸ ×”×•×¨×™×“×• ××ª ×”××©×—×§ ×”××•×›×Ÿ</button>
    </div>
    <p>
        ××ª ×”×§×•×‘×¥ × ×™×ª×Ÿ ×œ×©×œ×•×— ×™×©×™×¨×•×ª ×œ×¡×˜×•×“× ×˜×™×<br>
        ××• ×œ×”×¢×œ×•×ª ×œ××•×“×œ ×¢×œ ×™×“×™ ×”×¢×œ××ª ××©××‘ ××¡×•×’ "×§×•×‘×¥".
    </p>
</div>

<script>
    let processedCards = null;

    // ×”××–× ×” ×œ×‘×—×™×¨×ª ×§×•×‘×¥
    document.getElementById('fileInput').addEventListener('change', handleFile, false);
    
    // ×”××–× ×” ×œ×©×™× ×•×™ ×‘×ª×¤×¨×™×˜ ×”×§×™×“×•×“ - ××¤×¢×™×œ ××—×“×© ××ª ×”×§×¨×™××” ×× ×›×‘×¨ × ×‘×—×¨ ×§×•×‘×¥
    document.getElementById('encodingSelect').addEventListener('change', () => {
        const fileInput = document.getElementById('fileInput');
        if (fileInput.files.length > 0) {
            handleFile({ target: fileInput });
        }
    });

    function handleFile(e) {
        const file = e.target.files[0];
        const statusDiv = document.getElementById('status');
        const downloadBtn = document.getElementById('downloadBtn');
        const encodingType = document.getElementById('encodingSelect').value;
        
        // ××™×¤×•×¡
        downloadBtn.style.display = "none";
        statusDiv.className = "";
        processedCards = null;

        if (!file) return;

        statusDiv.innerText = "×§×•×¨× ×§×•×‘×¥...";
        
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                // ×”××¨×” ×™×©×™×¨×” ×œ×˜×§×¡×˜, ×”×“×¤×“×¤×Ÿ ××˜×¤×œ ×‘×§×™×“×•×“
                const data = e.target.result;
                
                // ×§×¨×™××” ×‘×××¦×¢×•×ª ×”×¡×¤×¨×™×™×” ×›×˜×§×¡×˜
                const workbook = XLSX.read(data, {type: 'string'});
                
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                
                const validData = [];
                
                for(let i=0; i<jsonData.length; i++) {
                    const row = jsonData[i];
                    if(row.length >= 2 && row[0] != null && row[1] != null) {
                        let q = row[0].toString().trim();
                        let a = row[1].toString().trim();
                        
                        if (i === 0 && (q === "×©××œ×”" || q.toLowerCase() === "question")) continue;
                        if (q === "" || a === "") continue;

                        validData.push({ question: q, answer: a });
                    }
                }

                if (validData.length === 0) {
                    throw new Error("×œ× × ××¦××• × ×ª×•× ×™×. ×‘×“×§×™ ×©×”×§×•×‘×¥ ××›×™×œ ×¢××•×“×•×ª ×©××œ×” ×•×ª×©×•×‘×”.");
                }

                processedCards = validData;
                // ×”×¦×’×ª ×”×©××œ×” ×”×¨××©×•× ×” ×›×“×•×’××” ×›×“×™ ×©×”××©×ª××© ×™×¨××” ×× ×–×” ×’'×™×‘×¨×™×©
                statusDiv.innerText = `âœ… × ×˜×¢× ×• ${validData.length} ×›×¨×˜×™×¡×™×•×ª!\n\n×”× ×” ×“×•×’××” ×œ×›×¨×˜×™×¡×™×™×” ×”×¨××©×•× ×” (×”×× ×–×” ×§×¨×™×?):\n"${validData[0].question}"`;
                statusDiv.className = "success";
                downloadBtn.style.display = "block";

            } catch (err) {
                console.error(err);
                statusDiv.innerText = "âŒ ×©×’×™××”: " + err.message + "\n(× ×¡×• ×œ×©× ×•×ª ××ª ×¡×•×’ ×”×§×™×“×•×“ ×‘×ª×¤×¨×™×˜ ×œ××¢×œ×”)";
                statusDiv.className = "error";
            }
        };

        // ×›××Ÿ ×”×§×¡×: ×©×™××•×© ×‘-readAsText ×¢× ×”×§×™×“×•×“ ×©×”××©×ª××© ×‘×—×¨
        // ×–×” ×”×¨×‘×” ×™×•×ª×¨ ×××™×Ÿ ×××©×¨ × ×™×—×•×© ××•×˜×•××˜×™ ×©×œ ×”×¡×¤×¨×™×™×” ×‘×§×‘×¦×™ CSV
        reader.readAsText(file, encodingType);
    }

    function downloadGame() {
        if (!processedCards) return;

        // ×‘× ×™×™×ª ×”×§×•×‘×¥ ×”×¡×•×¤×™
        const htmlContent = `<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×›×¨×˜×™×¡×™×•×ª ×ª×¨×’×•×œ</title>
    <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\\\(', '\\\\)']], displayMath: [['$$', '$$'], ['\\\\[', '\\\\]']] }
    };
    <\/script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden; 
        }
        
        /* ×¢×™×¦×•×‘ ×”×œ×•×’×• ×‘××©×—×§ ×¢×¦××• */
        .game-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            max-width: 300px;
            max-height: 240px;
            opacity: 0.9;
            z-index: 10;
        }

        .container { perspective: 1000px; width: 90%; max-width: 600px; height: 400px; position: relative; }
        .card { width: 100%; height: 100%; position: absolute; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1); cursor: pointer; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .card.flipped { transform: rotateX(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; box-sizing: border-box; text-align: center; border-radius: 20px; font-size: 1.6rem; color: #333; overflow-y: auto; background-color: white; border: 1px solid rgba(0,0,0,0.05); }
        .front { background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%); }
        .back { background: linear-gradient(135deg, #fff9f9 0%, #fff0f0 100%); transform: rotateX(180deg); }
        
        .controls { margin-top: 30px; display: flex; gap: 20px; }
        button { padding: 12px 28px; font-size: 1rem; border: none; border-radius: 50px; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.1); font-weight: 600; font-family: inherit; }
        #nextBtn { background-color: #8ac6d1; color: white; }
        #nextBtn:hover { background-color: #72b2bd; transform: translateY(-2px); }
        #resetBtn { background-color: #ff8fab; color: white; }
        #resetBtn:hover { background-color: #ff7597; transform: translateY(-2px); }
        
        .progress { margin-top: 20px; color: #888; font-size: 0.9rem; font-weight: 500; }
        .hint { margin-top: 10px; font-size: 0.8rem; color: #aaa; }
        mjx-container { font-size: 110% !important; }
    </style>
</head>
<body>
    <img src="logo.jpg" class="game-logo" onerror="this.style.display='none'" alt="×œ×•×’×•">

    <div class="container" onclick="flipCard()">
        <div class="card" id="card">
            <div class="face front"><div id="questionText">×˜×•×¢×Ÿ...</div></div>
            <div class="face back"><div id="answerText">×˜×•×¢×Ÿ...</div></div>
        </div>
    </div>
    <div class="progress" id="progressText"></div>
    <div class="controls">
        <button id="resetBtn" onclick="resetGame(event)">××™×¤×•×¡</button>
        <button id="nextBtn" onclick="nextCard(event)">×”×‘× (Enter)</button>
    </div>
    <div class="hint">×¨×•×•×— ×œ×”×¤×•×š, Enter ×œ××¢×‘×¨</div>
    <script>
        const cardsData = ${JSON.stringify(processedCards)};
        let deck = [];
        let currentCardIndex = -1;
        
        function initGame() { 
            deck = Array.from(Array(cardsData.length).keys()); 
            shuffleDeck(); 
            nextCard(); 
        }
        
        function shuffleDeck() { 
            for (let i = deck.length - 1; i > 0; i--) { 
                const j = Math.floor(Math.random() * (i + 1)); 
                [deck[i], deck[j]] = [deck[j], deck[i]]; 
            } 
        }
        
        function updateProgress() { 
            const remaining = deck.length; 
            const total = cardsData.length; 
            document.getElementById('progressText').innerText = \`×›×¨×˜×™×¡×™×™×” \${total - remaining} ××ª×•×š \${total}\`; 
        }
        
        function nextCard(event) { 
            if (event) event.stopPropagation(); 
            if (deck.length === 0) { 
                alert("×›×œ ×”×›×‘×•×“! ×¡×™×™××ª ××ª ×›×œ ×”×›×¨×˜×™×¡×™×•×ª."); 
                initGame(); 
                return; 
            } 
            const cardElement = document.getElementById('card'); 
            cardElement.classList.remove('flipped'); 
            
            currentCardIndex = deck.pop(); 
            
            setTimeout(() => { 
                document.getElementById('questionText').innerHTML = cardsData[currentCardIndex].question; 
                document.getElementById('answerText').innerHTML = cardsData[currentCardIndex].answer; 
                if (window.MathJax) { 
                    MathJax.typesetPromise([document.getElementById('card')]).catch((err) => console.log(err)); 
                } 
                updateProgress(); 
            }, 200); 
        }
        
        function flipCard() { 
            document.getElementById('card').classList.toggle('flipped'); 
        }
        
        function resetGame(event) { 
            if (event) event.stopPropagation(); 
            if (confirm("×œ×”×ª×—×™×œ ××—×“×©?")) initGame(); 
        }
        
        document.addEventListener('keydown', function(event) { 
            if (event.code === 'Space') { event.preventDefault(); flipCard(); } 
            else if (event.code === 'Enter') { event.preventDefault(); nextCard(); } 
        });
        
        window.onload = initGame;
    <\/script>
</body>
</html>`;

        const blob = new Blob([htmlContent], {type: "text/html;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "flashcards_game.html";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>
